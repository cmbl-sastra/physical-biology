<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negative Feedback Loop Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Negative Feedback Loop Simulator</h1>
            <p class="text-md sm:text-lg text-gray-600 mt-2">Explore the dynamics of a system where A produces B, and B inhibits A.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Controls Panel -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl font-semibold mb-6 border-b pb-3">Control Panel</h2>
                <div id="controls" class="space-y-5">
                    <!-- Sliders will be dynamically inserted here -->
                </div>
            </div>

            <!-- Plot Area -->
            <div class="lg:col-span-2 bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-gray-200 flex items-center justify-center">
                <canvas id="concentrationChart"></canvas>
            </div>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. DEFINE PARAMETERS AND CONFIGURATION
            // These define the sliders and their properties for the simulation.
            const paramsConfig = {
                initialA:      { label: 'Initial A', min: 0, max: 100, step: 1, value: 50 },
                initialB:      { label: 'Initial B', min: 0, max: 100, step: 1, value: 10 },
                sourceA:       { label: 'A Production', min: 0, max: 10, step: 0.1, value: 2 },
                inhibition:    { label: 'B Inhibits A', min: 0, max: 1, step: 0.01, value: 0.2 },
                decayA:        { label: 'A Decay Rate', min: 0, max: 1, step: 0.01, value: 0.1 },
                productionB:   { label: 'B Production (from A)', min: 0, max: 1, step: 0.01, value: 0.05 },
                decayB:        { label: 'B Decay Rate', min: 0, max: 1, step: 0.01, value: 0.05 },
            };

            const controlsContainer = document.getElementById('controls');
            const ctx = document.getElementById('concentrationChart').getContext('2d');

            // 2. CREATE UI CONTROLS (SLIDERS)
            // Dynamically generate sliders based on the configuration object.
            Object.entries(paramsConfig).forEach(([key, config]) => {
                const controlDiv = document.createElement('div');
                controlDiv.className = 'flex flex-col';

                const label = document.createElement('label');
                label.htmlFor = key;
                label.className = 'text-sm font-medium text-gray-700 mb-1 flex justify-between';
                
                const labelText = document.createElement('span');
                labelText.textContent = config.label;
                
                const valueSpan = document.createElement('span');
                valueSpan.id = `${key}-value`;
                valueSpan.className = 'font-semibold';
                valueSpan.textContent = config.value;

                label.appendChild(labelText);
                label.appendChild(valueSpan);

                const slider = document.createElement('input');
                slider.type = 'range';
                slider.id = key;
                slider.min = config.min;
                slider.max = config.max;
                slider.step = config.step;
                slider.value = config.value;
                slider.className = 'w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer';

                controlDiv.appendChild(label);
                controlDiv.appendChild(slider);
                controlsContainer.appendChild(controlDiv);
            });

            // 3. INITIALIZE THE PLOT (CHART.JS)
            // Sets up the chart with initial empty data and configuration.
            const concentrationChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [], // Time points
                    datasets: [
                        {
                            label: 'Concentration of A',
                            data: [],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2.5,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: true,
                        },
                        {
                            label: 'Concentration of B',
                            data: [],
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2.5,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: true,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    animation: {
                        duration: 0 // Disable animation for instant updates
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time',
                                font: { size: 14 }
                            },
                            grid: {
                                color: 'rgba(200, 200, 200, 0.2)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Concentration',
                                font: { size: 14 }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(200, 200, 200, 0.2)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });

            // 4. THE SIMULATION ENGINE
            // This function runs the core logic of the simulation.
            function runSimulation() {
                // Read current values from all sliders
                const params = {};
                Object.keys(paramsConfig).forEach(key => {
                    params[key] = parseFloat(document.getElementById(key).value);
                });

                // Simulation constants
                const dt = 0.1; // Time step
                const numSteps = 2000; // Total simulation steps

                // Initialize arrays to hold the results
                let A = params.initialA;
                let B = params.initialB;
                const timePoints = [];
                const concentrationA = [];
                const concentrationB = [];

                // The core simulation loop using the Euler method for numerical integration
                for (let i = 0; i < numSteps; i++) {
                    timePoints.push(i * dt);
                    concentrationA.push(A);
                    concentrationB.push(B);

                    // These are the differential equations governing the system
                    // dA/dt = (source of A) - (inhibition by B) - (natural decay of A)
                    const dAdt = params.sourceA - (params.inhibition * B) - (params.decayA * A);
                    
                    // dB/dt = (production from A) - (natural decay of B)
                    const dBdt = (params.productionB * A) - (params.decayB * B);

                    // Update concentrations for the next time step
                    A += dAdt * dt;
                    B += dBdt * dt;

                    // Ensure concentrations don't go below zero
                    if (A < 0) A = 0;
                    if (B < 0) B = 0;
                }

                return { timePoints, concentrationA, concentrationB };
            }

            // 5. UPDATE FUNCTION
            // This function calls the simulation and then updates the chart with the new data.
            function updatePlot() {
                const { timePoints, concentrationA, concentrationB } = runSimulation();
                
                concentrationChart.data.labels = timePoints;
                concentrationChart.data.datasets[0].data = concentrationA;
                concentrationChart.data.datasets[1].data = concentrationB;
                
                concentrationChart.update();
            }
            
            // 6. EVENT LISTENERS
            // Listen for changes on any slider and update the plot accordingly.
            controlsContainer.addEventListener('input', (event) => {
                if (event.target.type === 'range') {
                    // Update the text value next to the slider label
                    document.getElementById(`${event.target.id}-value`).textContent = event.target.value;
                    updatePlot();
                }
            });

            // 7. INITIAL RUN
            // Run the simulation and draw the plot when the page first loads.
            updatePlot();
        });
    </script>

</body>
</html>
